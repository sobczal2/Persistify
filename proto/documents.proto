syntax = "proto3";
package Persistify.Services;

message AndSearchNode {
   repeated SearchNode Nodes = 1;
}
message BoolFieldValue {
   bool Value = 1;
   string FieldName = 2;
}
message BoolSearchNode {
   string FieldName = 1;
   bool Value = 2;
}
message CreateDocumentRequest {
   int32 TemplateId = 1;
   repeated TextFieldValue TextFieldValues = 2;
   repeated NumberFieldValue NumberFieldValues = 3;
   repeated BoolFieldValue BoolFieldValues = 4;
}
message CreateDocumentResponse {
   int32 DocumentId = 1;
}
message DeleteDocumentRequest {
   int32 TemplateId = 1;
   int64 DocumentId = 2;
}
message DeleteDocumentResponse {
}
message Document {
   int32 Id = 1;
   repeated TextFieldValue TextFieldValues = 2;
   repeated NumberFieldValue NumberFieldValues = 3;
   repeated BoolFieldValue BoolFieldValues = 4;
}
enum FtsSearchMode {
   Prefix = 0;
   Suffix = 1;
   Exact = 2;
   Contains = 3;
}
message FtsSearchNode {
   string FieldName = 1;
   string Value = 2;
   FtsSearchMode Mode = 3;
}
message GetDocumentRequest {
   int32 TemplateId = 1;
   int32 DocumentId = 2;
}
message GetDocumentResponse {
   Document Document = 1;
}
message NotSearchNode {
}
message NumberFieldValue {
   double Value = 1;
   string FieldName = 2;
}
message NumberRangeSearchNode {
   string FieldName = 1;
   double Min = 2;
   double Max = 3;
   bool IncludeMin = 4;
   bool IncludeMax = 5;
}
enum NumberSearchMode {
   Equal = 0;
   NotEqual = 1;
   GreaterThan = 2;
   GreaterThanOrEqual = 3;
   LessThan = 4;
   LessThanOrEqual = 5;
}
message NumberSearchNode {
   string FieldName = 1;
   double Value = 2;
   NumberSearchMode Mode = 3;
}
message OrSearchNode {
   repeated SearchNode Nodes = 1;
}
message Pagination {
   int32 PageNumber = 1;
   int32 PageSize = 2;
}
message SearchDocumentsRequest {
   int32 TemplateId = 1;
   Pagination Pagination = 2;
   SearchNode SearchNode = 3;
}
message SearchDocumentsResponse {
   repeated Document Documents = 1;
   int64 TotalCount = 2;
}
message SearchNode {
   oneof subtype {
      AndSearchNode AndSearchNode = 1;
      OrSearchNode OrSearchNode = 2;
      NotSearchNode NotSearchNode = 3;
      TextSearchNode TextSearchNode = 4;
      FtsSearchNode FtsSearchNode = 5;
      NumberSearchNode NumberSearchNode = 6;
      NumberRangeSearchNode NumberRangeSearchNode = 7;
      BoolSearchNode BoolSearchNode = 8;
   }
}
message TextFieldValue {
   string Value = 1;
   string FieldName = 2;
}
message TextSearchNode {
   string FieldName = 1;
   string Value = 2;
}
service DocumentService {
   rpc CreateDocument (CreateDocumentRequest) returns (CreateDocumentResponse);
   rpc DeleteDocument (DeleteDocumentRequest) returns (DeleteDocumentResponse);
   rpc GetDocument (GetDocumentRequest) returns (GetDocumentResponse);
   rpc SearchDocuments (SearchDocumentsRequest) returns (SearchDocumentsResponse);
}
